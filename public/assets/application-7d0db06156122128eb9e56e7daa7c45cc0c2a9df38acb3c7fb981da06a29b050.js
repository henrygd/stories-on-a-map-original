function storyContainer(e){var t=this;this.el=e.el,this.type=e.type,this.stories=e.stories,this.storiesCopy=e.stories.slice(0),this.sortButtons=$(e.el).find(".subheading > button"),this.showMoreEl=$(e.el).find(".view-more"),this.sortButtons.bind("click",function(e){t.changeSort(e)}),this.showMoreEl.bind("click",function(){t.showMore()}),this.showMore()}!function(e,t){"use strict";e.rails!==t&&e.error("jquery-ujs has already been loaded!");var o,n=e(document);e.rails=o={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",csrfToken:function(){return e("meta[name=csrf-token]").attr("content")},csrfParam:function(){return e("meta[name=csrf-param]").attr("content")},CSRFProtection:function(e){var t=o.csrfToken();t&&e.setRequestHeader("X-CSRF-Token",t)},refreshCSRFTokens:function(){e('form input[name="'+o.csrfParam()+'"]').val(o.csrfToken())},fire:function(t,o,n){var r=e.Event(o);return t.trigger(r,n),r.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},href:function(e){return e[0].href},isRemote:function(e){return e.data("remote")!==t&&e.data("remote")!==!1},handleRemote:function(n){var r,a,i,l,s,c;if(o.fire(n,"ajax:before")){if(l=n.data("with-credentials")||null,s=n.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,n.is("form")){r=n.attr("method"),a=n.attr("action"),i=n.serializeArray();var u=n.data("ujs:submit-button");u&&(i.push(u),n.data("ujs:submit-button",null))}else n.is(o.inputChangeSelector)?(r=n.data("method"),a=n.data("url"),i=n.serialize(),n.data("params")&&(i=i+"&"+n.data("params"))):n.is(o.buttonClickSelector)?(r=n.data("method")||"get",a=n.data("url"),i=n.serialize(),n.data("params")&&(i=i+"&"+n.data("params"))):(r=n.data("method"),a=o.href(n),i=n.data("params")||null);return c={type:r||"GET",data:i,dataType:s,beforeSend:function(e,r){return r.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+r.accepts.script),o.fire(n,"ajax:beforeSend",[e,r])?void n.trigger("ajax:send",e):!1},success:function(e,t,o){n.trigger("ajax:success",[e,t,o])},complete:function(e,t){n.trigger("ajax:complete",[e,t])},error:function(e,t,o){n.trigger("ajax:error",[e,t,o])},crossDomain:o.isCrossDomain(a)},l&&(c.xhrFields={withCredentials:l}),a&&(c.url=a),o.ajax(c)}return!1},isCrossDomain:function(e){var t=document.createElement("a");t.href=location.href;var o=document.createElement("a");try{return o.href=e,o.href=o.href,!((!o.protocol||":"===o.protocol)&&!o.host||t.protocol+"//"+t.host==o.protocol+"//"+o.host)}catch(n){return!0}},handleMethod:function(n){var r=o.href(n),a=n.data("method"),i=n.attr("target"),l=o.csrfToken(),s=o.csrfParam(),c=e('<form method="post" action="'+r+'"></form>'),u='<input name="_method" value="'+a+'" type="hidden" />';s===t||l===t||o.isCrossDomain(r)||(u+='<input name="'+s+'" value="'+l+'" type="hidden" />'),i&&c.attr("target",i),c.hide().append(u).appendTo("body"),c.submit()},formElements:function(t,o){return t.is("form")?e(t[0].elements).filter(o):t.find(o)},disableFormElements:function(t){o.formElements(t,o.disableSelector).each(function(){o.disableFormElement(e(this))})},disableFormElement:function(e){var o,n;o=e.is("button")?"html":"val",n=e.data("disable-with"),e.data("ujs:enable-with",e[o]()),n!==t&&e[o](n),e.prop("disabled",!0)},enableFormElements:function(t){o.formElements(t,o.enableSelector).each(function(){o.enableFormElement(e(this))})},enableFormElement:function(e){var t=e.is("button")?"html":"val";"undefined"!=typeof e.data("ujs:enable-with")&&e[t](e.data("ujs:enable-with")),e.prop("disabled",!1)},allowAction:function(e){var t,n=e.data("confirm"),r=!1;if(!n)return!0;if(o.fire(e,"confirm")){try{r=o.confirm(n)}catch(a){(console.error||console.log).call(console,a.stack||a)}t=o.fire(e,"confirm:complete",[r])}return r&&t},blankInputs:function(t,o,n){var r,a,i=e(),l=o||"input,textarea",s=t.find(l);return s.each(function(){if(r=e(this),a=r.is("input[type=checkbox],input[type=radio]")?r.is(":checked"):!!r.val(),a===n){if(r.is("input[type=radio]")&&s.filter('input[type=radio]:checked[name="'+r.attr("name")+'"]').length)return!0;i=i.add(r)}}),i.length?i:!1},nonBlankInputs:function(e,t){return o.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},disableElement:function(e){var n=e.data("disable-with");e.data("ujs:enable-with",e.html()),n!==t&&e.html(n),e.bind("click.railsDisable",function(e){return o.stopEverything(e)})},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.removeData("ujs:enable-with")),e.unbind("click.railsDisable")}},o.fire(n,"rails:attachBindings")&&(e.ajaxPrefilter(function(e,t,n){e.crossDomain||o.CSRFProtection(n)}),e(window).on("pageshow.rails",function(){e(e.rails.enableSelector).each(function(){var t=e(this);t.data("ujs:enable-with")&&e.rails.enableFormElement(t)}),e(e.rails.linkDisableSelector).each(function(){var t=e(this);t.data("ujs:enable-with")&&e.rails.enableElement(t)})}),n.delegate(o.linkDisableSelector,"ajax:complete",function(){o.enableElement(e(this))}),n.delegate(o.buttonDisableSelector,"ajax:complete",function(){o.enableFormElement(e(this))}),n.delegate(o.linkClickSelector,"click.rails",function(t){var n=e(this),r=n.data("method"),a=n.data("params"),i=t.metaKey||t.ctrlKey;if(!o.allowAction(n))return o.stopEverything(t);if(!i&&n.is(o.linkDisableSelector)&&o.disableElement(n),o.isRemote(n)){if(i&&(!r||"GET"===r)&&!a)return!0;var l=o.handleRemote(n);return l===!1?o.enableElement(n):l.fail(function(){o.enableElement(n)}),!1}return r?(o.handleMethod(n),!1):void 0}),n.delegate(o.buttonClickSelector,"click.rails",function(t){var n=e(this);if(!o.allowAction(n)||!o.isRemote(n))return o.stopEverything(t);n.is(o.buttonDisableSelector)&&o.disableFormElement(n);var r=o.handleRemote(n);return r===!1?o.enableFormElement(n):r.fail(function(){o.enableFormElement(n)}),!1}),n.delegate(o.inputChangeSelector,"change.rails",function(t){var n=e(this);return o.allowAction(n)&&o.isRemote(n)?(o.handleRemote(n),!1):o.stopEverything(t)}),n.delegate(o.formSubmitSelector,"submit.rails",function(n){var r,a,i=e(this),l=o.isRemote(i);if(!o.allowAction(i))return o.stopEverything(n);if(i.attr("novalidate")===t&&(r=o.blankInputs(i,o.requiredInputSelector,!1),r&&o.fire(i,"ajax:aborted:required",[r])))return o.stopEverything(n);if(l){if(a=o.nonBlankInputs(i,o.fileInputSelector)){setTimeout(function(){o.disableFormElements(i)},13);var s=o.fire(i,"ajax:aborted:file",[a]);return s||setTimeout(function(){o.enableFormElements(i)},13),s}return o.handleRemote(i),!1}setTimeout(function(){o.disableFormElements(i)},13)}),n.delegate(o.formInputClickSelector,"click.rails",function(t){var n=e(this);if(!o.allowAction(n))return o.stopEverything(t);var r=n.attr("name"),a=r?{name:r,value:n.val()}:null;n.closest("form").data("ujs:submit-button",a)}),n.delegate(o.formSubmitSelector,"ajax:send.rails",function(t){this===t.target&&o.disableFormElements(e(this))}),n.delegate(o.formSubmitSelector,"ajax:complete.rails",function(t){this===t.target&&o.enableFormElements(e(this))}),e(function(){o.refreshCSRFTokens()}))}(jQuery),function(){function e(){p=b[v]("bp_img")||t(),m=p.parentNode,m[y]("click",function(e){s(e)}),p[y]("load",n),p[y]("error",function(){n("image")})}function t(){return b.head.insertAdjacentHTML("beforeend","<style>#bp_container{bottom:0;left:0;right:0;visibility:hidden;position:fixed;top:0;z-index:99999999;background:rgba(0,0,0,.7);opacity:0;transition:opacity .35s}#bp_img,.bp-close{position:absolute;right:0;top:0}#bp_img{display:none;max-height:96%;max-width:96%;bottom:0;left:0;box-shadow:0 0 3em rgba(0,0,0,.5);transition:-webkit-transform .35s;transition:transform .35s;transition:transform .35s,-webkit-transform .35s}.bp-close{cursor:pointer;height:3.5em;width:3.5em;opacity:.85;background:url(data:image/svg+xml;charset=utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20357%20357%22%3E%3Cpath%20fill%3D%22%23FFF%22%20d%3D%22M357%2035.7L321.3%200%20178.5%20142.8%2035.7%200%200%2035.7l142.8%20142.8L0%20321.3%2035.7%20357l142.8-142.8L321.3%20357l35.7-35.7-142.8-142.8%22%2F%3E%3C%2Fsvg%3E) center center no-repeat;background-size:1.2em}.bp-close:hover{opacity:1!important}@media screen and (max-aspect-ratio:9/5){#bp_sv{height:54vw;width:96vw}}</style>"),b.body.insertAdjacentHTML("beforeend",'<div id="bp_container"><img id="bp_img"><div class="bp-close"></div></div>'),b[v]("bp_img")}function o(){var e=c.getBoundingClientRect(),t=e.left-(m.clientWidth/2-e.width/2),o=e.top-(m.clientHeight/2-e.height/2),n=c.clientWidth/d.clientWidth,r=c.clientHeight/d.clientHeight;return"translate3D("+t+"px, "+o+"px, 0) scale3D("+n+", "+r+", 0);"}function n(e){"string"==typeof e?alert("Error: The requested "+e+" could not be displayed."):l()}function r(e,t,o){e.style.cssText=t}function a(e,t){e.style.cssText+=t}function i(e){return"-webkit-"+e+e}function l(){r(d,"display:block;"),a(d,i("transition:none;")+i("transform:"+o())),r(m,"visibility:visible;opacity:1"),f=setTimeout(function(){r(d,"display:block;margin:auto;"+i("transform:none;"))},40)}function s(e){clearTimeout(f),a(d,i("transform:"+o())),m.style.opacity="0",setTimeout(function(){r(m,""),r(d,"")},305)}var c,u,d,p,f,m,h=window,g=h.BigPicture=h.BigPicture||{},b=document,v="getElementById",y="addEventListener";g.create=function(t){if(/bp_(container|img)/.test(t.el.id))throw"BigPicture called on own display element";u||e();for(var o in t)g[o]=t[o];c=g.el,d=p,p.src=c.src}}(),$(function(){var e=window.MyAjax={},t=$("#loading-icon"),o=$("#pu_head").find("h2"),n=$("#popup_inner");$(document).bind("ajaxSend",function(){t.show()}).bind("ajaxComplete",function(){t.hide()}),e.popupForm=function(e,t,r){return o.html('<i class="fa '+t+'"></i> '+e),n.html(r),HomePopup.show(),this},e.newNavbar=function(e){$("#navbar")[0].outerHTML=e,Navbar.initialize()},e.checkLogin=function(){try{var e=localStorage.getItem("is_logged_in");"true"===e&&$("#login_link").length>0?$.getScript("/scripts/newnavbar.js"):"false"===e&&$("#account_link").length>0&&$.getScript("/scripts/newnavbar.js")}catch(t){alert("To function properly, this site requires a browser which supports local storage")}}});var Bookmarks={sendRequest:function(e,t){$("#bookmark_icon").removeClass().addClass("fa fa-spinner fa-spin"),$.ajax({global:!1,type:e,url:"/bookmarks/"+t,success:function(e){myBookmarks=e.ids,myBookmarks.indexOf(t)>-1?$("#bookmark_icon").removeClass().addClass("fa fa-bookmark"):$("#bookmark_icon").removeClass().addClass("fa fa-bookmark-o")}})},getIDs:function(){$.getJSON("/bookmarks/ids.json",function(e){myBookmarks=e.ids})},bindClick:function(){setTimeout(function(){$("#bookmark_popup").on("click",".but-website",function(e){"undefined"!=typeof myMap.map&&(HomePopup.close(),myMap.markerClick($(this.href.split("/")).last()[0]),e.preventDefault())}),$("#bookmark_popup .view-more").bind("click",function(){setTimeout(function(){$("#popup_inner").perfectScrollbar("update")},100)})},500)}};$(function(){var e=$("#main_content");window.HomePopup={},$("#cross_close, #popup_overlay").click(function(){HomePopup.close()}),HomePopup.show=function(){e.addClass("show-popup-display"),setTimeout(function(){e.addClass("show-popup-fadein")},100),setTimeout(function(){$("#popup_inner").perfectScrollbar({scrollYMarginOffset:8})},50)},HomePopup.close=function(){e.removeClass("show-popup-fadein"),setTimeout(function(){e.removeClass("show-popup-display"),$("#popup_inner").perfectScrollbar("destroy")},400)}}),HomePage={onLoad:function(){myMap.initialize(),"true"===localStorage.getItem("is_logged_in")&&Bookmarks.getIDs(),StoryModal.optionsPanel.initialize(),setTimeout(StoryModal.initializeScrollbar,100),HomePage.pushState(),setTimeout(function(){$.getJSON("storylist.json",function(e){e.forEach(function(e,t){myMap.newMarker(e[0],e[2]+"\n"+e[1],e[3])})})},1500)},pushState:function(){"undefined"!=typeof history.replaceState&&history.replaceState({slug:""},null,null),window.onpopstate=function(e){""!==e.state.slug?StoryModal.show(e.state):StoryModal.hide()}}},function(){var e="/static/img/"+(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./)?"favicon.png":"book_icon.svg");myMap={initialize:function(){var e={center:{lat:39,lng:-95},zoom:4,minZoom:2,mapTypeId:google.maps.MapTypeId.TERRAIN,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER}};myMap.map=new google.maps.Map(document.getElementById("map-canvas"),e)},newMarker:function(t,o,n){splitCoords=t.split(", ");var r=new google.maps.Marker({position:new google.maps.LatLng(splitCoords[0],splitCoords[1]),map:myMap.map,title:o,munged_title:n,icon:{url:e,scaledSize:new google.maps.Size(45,45),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(22.5,22.5)}});return google.maps.event.addListener(r,"click",function(){myMap.markerClick(this.munged_title)}),r},markerClick:function(e){var t;$("body").addClass("cursor-wait"),$("#modal-container").hasClass("show-story")||(t="/stories/"),$.getJSON("/stories/"+e+".json",function(o){history.pushState({slug:"modal",title:o.title,author:o.author,id:o.id,content:o.content,picture:o.picture,background:o.background},null,t+e),StoryModal.show(o)})},newStory:{initialize:function(){var t=new google.maps.LatLng(39,-95),o={center:t,zoom:3,mapTypeId:google.maps.MapTypeId.TERRAIN,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER}};newStoryMap=new google.maps.Map(document.getElementById("new_story_map"),o),newStoryMarker=new google.maps.Marker({position:t,draggable:!0,map:newStoryMap,icon:{url:e,scaledSize:new google.maps.Size(45,45),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(22.5,22.5)}}),google.maps.event.addListener(newStoryMarker,"dragend",function(e){$('input[id="story_coords"]').val(e.latLng.lat().toFixed(6)+", "+e.latLng.lng().toFixed(6)),newStoryMap.panTo(e.latLng)})},setMarker:function(e){var t=e.split(", "),o=new google.maps.LatLng(t[0],t[1]);newStoryMarker.setPosition(o),newStoryMap.panTo(o)}}}}(),$(function(){function e(){c=$("#navbar"),u=$("#submenu"),d=$("#navbar_close"),p=$("#submenu_container"),f=$("#menu_icon");var e=$("#navbar_more");e.on("click",function(e){u.hasClass("show-submenu")?n():o(),e.preventDefault()}),d.on("click",function(){$(m).width()<768?s():r()}),f.on("click",a),t(),$(m).on("resize",t)}function t(){var e=c.width(),t=e-500,o=Math.floor(t/250),n=$("#navbar-menu").find(".nav-link"),r=n.length;return 768>e?(u.append(n),void p.removeClass("hide")):void(0===o?(u.append(n),p.removeClass("hide")):o>=r-2?p.before(n).addClass("hide"):(u.append(n.slice(o,r)),p.before(n.slice(0,o)).removeClass("hide")))}function o(){var e=e;e.addClass("show-submenu"),setTimeout(function(){$("body").one("click",function(){n()})},20)}function n(){u.removeClass("show-submenu")}function r(){c.addClass("hide-nav"),l()}function a(){c.removeClass("hide-nav"),i()}function i(){f.removeClass("show-menu-icon")}function l(){f.addClass("show-menu-icon")}function s(){p.hasClass("hide-mobile")?(p.removeClass("hide-mobile"),d.addClass("navbar-cross"),setTimeout(function(){$("body").one("click",function(){p.addClass("hide-mobile"),d.removeClass("navbar-cross")})},20)):(p.addClass("hide-mobile"),d.removeClass("navbar-cross"))}var c,u,d,p,f,m=window,h=m.Navbar={};h.initialize=e,h.show=a,h.hide=r,e()});var NewStory={onLoadAction:function(){function e(e){return"url(https://source.unsplash.com/category/nature/"+e.width()+"x"+e.height()+")"}$("#svg_holder, #image_one").css("background-image",e($("#svg_holder"))),$("#modal-container, #image_two").css("background-image",e($("#modal-container"))),this.article=$("article"),this.articleHeight=0,myMap.newStory.initialize(),StoryModal.optionsPanel.initialize(),setTimeout(function(){$("#modal-container, #story-modal").addClass("show-modal")},200),$("#story-modal").perfectScrollbar({scrollYMarginOffset:8}),this.article.bind("DOMSubtreeModified",function(e){var t=e.target;if("IMG"===t.tagName)$(t).on("load",function(){$("#story-modal").perfectScrollbar("update")});else{var o=NewStory.article.height();o!==NewStory.articleHeight&&(NewStory.articleHeight=o,$("#story-modal").perfectScrollbar("update"))}}),NewStory.bindImageChange();new MediumEditor(".editable",{buttons:["bold","italic","underline","quote","image"],buttonLabels:"fontawesome",targetBlank:!0});$("#close_image_panel").on("click",function(){NewStory.imagePanel.hide()}),$("[contenteditable]").focusout(function(){var e=$(this);e.text().trim().length||e.empty()}),setTimeout(function(){$("#new_story_map").addClass("hide-instructions")},1700),$("#image_upload_panel").find("button, input").attr("tabindex","-1"),window.onbeforeunload=function(){return"Are you sure you want to leave? Unsaved changes will be lost."}},saveStory:function(){"undefined"!=typeof Storage?(localStorage.setItem("story-title",$("#story-title").text()),localStorage.setItem("story-author",$("#story-author").text()),localStorage.setItem("story-content",$("#story-content").html()),localStorage.setItem("story_coords",$("#story_coords").val()||"39, -95"),localStorage.setItem("story-picture",$("#image_one").css("background-image")),localStorage.setItem("story-background",$("#image_two").css("background-image"))):alert("Sorry, your browser does not support in-browser web storage")},loadStory:function(){if("undefined"!=typeof Storage){var e=localStorage.getItem("story_coords");document.getElementById("story-modal");$("#story-title").text(localStorage.getItem("story-title")),$("#story-author").text(localStorage.getItem("story-author")),$("#story-content").html(localStorage.getItem("story-content")),$("#modal-container, #image_two").css("background-image",localStorage.getItem("story-background")),$("#svg_holder, #image_one").css("background-image",localStorage.getItem("story-picture")),$("#story_coords").val(e),myMap.newStory.setMarker(e),setTimeout(function(){StoryModal.scrollbar.update()},200)}else alert("Sorry, your browser does not support in-browser web storage")},bindImageChange:function(){$("#story_picture, #story_background").on("change",function(){""===this.value?"story_background"===this.id?$("#modal-container, #image_two").css("background-image","none"):$("#svg_holder, #image_one").css("background-image","none"):NewStory.validateImage(this)===!0?NewStory.imagePreview(this):this.value=""})},imagePreview:function(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(t){var o=t.target.result;"story_background"===e.id?$("#modal-container, #image_two").css("background-image","url("+o+")"):$("#svg_holder, #image_one").css("background-image","url("+o+")")},t.readAsDataURL(e.files[0])}},validateImage:function(e){var t=e.files[0].size/1024/1024,o=1;return"story_background"===e.id&&(o=2),t>o?void alert("Maximum file size is "+o+"MB. Please choose a smaller file."):!0},validateForm:function(){if("false"===localStorage.is_logged_in)return MyAjax.popupForm("Please Log In","fa-exclamation-triangle","<div class='pu-info'><p>You must <a data-remote='true' href='/login'>log in</a> or <a data-remote='true' href='/signup'>sign up</a> to complete this action.</p></div>"),void $("body").removeClass("cursor-wait");var e=[],t=$("#story-author").text(),o=$("#story-title").text(),n=$("#story-content").html().trim(),r=$("#story_coords").val(),a=$("#svg_holder").css("background-image"),i=$("#modal-container").css("background-image");if(""===t&&e.push("Author name is blank"),""===o&&e.push("Story title is blank"),""===n&&e.push("Story content is blank"),""===r&&e.push("Cannot read map position"),-1===a.indexOf("data:image")&&e.push("Please choose or rechoose your own story image"),-1===i.indexOf("data:image")&&e.push("Please choose or rechoose your own background image"),e.length>0)MyAjax.popupForm("Error","fa-exclamation-triangle",'<div class="pu-info pu-error"><ul><li>'+e.join("</li><li>")+"</li></ul></div>");else{if($("body").hasClass("cursor-wait"))return;$("body").addClass("cursor-wait");var l=function(e){for(var t=atob(e.split(",")[1]),o=e.split(",")[0].split(":")[1].split(";")[0],n=o.replace(/^\w*\//,""),r=new ArrayBuffer(t.length),a=new Uint8Array(r),i=0;i<t.length;i++)a[i]=t.charCodeAt(i);return console.log(n),[new Blob([r],{type:o}),n]},s=function(e){return l(e.replace(/^url|[\(|\)|'|"]/g,""))},c=new FormData,u=s(a),d=s(i),p="append";c[p]("story[author]",t),c[p]("story[coords]",r),c[p]("story[title]",o),c[p]("story[content]",n.replace(" rotate720","")),c[p]("story[picture]",u[0],"pic."+u[1]),c[p]("story[background]",d[0],"back."+d[1]),c[p]("X-Http-Accept","text/javascript, application/javascript"),$.ajax({method:"POST",url:"/stories",data:c,processData:!1,contentType:!1,dataType:"script"})}},imagePanel:{show:function(){$("body").addClass("show-image-upload-panel")},hide:function(){$("body").removeClass("show-image-upload-panel")}}};!function e(t,o,n){function r(i,l){if(!o[i]){if(!t[i]){var s="function"==typeof require&&require;if(!l&&s)return s(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[i]={exports:{}};t[i][0].call(u.exports,function(e){var o=t[i][1][e];return r(o?o:e)},u,u.exports,e,t,o,n)}return o[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)r(n[i]);return r}({1:[function(e,t,o){"use strict";function n(e){e.fn.perfectScrollbar=function(e){return this.each(function(){if("object"==typeof e||"undefined"==typeof e){var t=e;a.get(this)||r.initialize(this,t)}else{var o=e;"update"===o?r.update(this):"destroy"===o&&r.destroy(this)}})}}var r=e("../main"),a=e("../plugin/instances");if("function"==typeof define&&define.amd)define(["jquery"],n);else{var i=window.jQuery?window.jQuery:window.$;"undefined"!=typeof i&&n(i)}t.exports=n},{"../main":7,"../plugin/instances":18}],2:[function(e,t,o){"use strict";function n(e,t){var o=e.className.split(" ");o.indexOf(t)<0&&o.push(t),e.className=o.join(" ")}function r(e,t){var o=e.className.split(" "),n=o.indexOf(t);n>=0&&o.splice(n,1),e.className=o.join(" ")}o.add=function(e,t){e.classList?e.classList.add(t):n(e,t)},o.remove=function(e,t){e.classList?e.classList.remove(t):r(e,t)},o.list=function(e){return e.classList?Array.prototype.slice.apply(e.classList):e.className.split(" ")}},{}],3:[function(e,t,o){"use strict";function n(e,t){return window.getComputedStyle(e)[t]}function r(e,t,o){return"number"==typeof o&&(o=o.toString()+"px"),e.style[t]=o,e}function a(e,t){for(var o in t){var n=t[o];"number"==typeof n&&(n=n.toString()+"px"),e.style[o]=n}return e}var i={};i.e=function(e,t){var o=document.createElement(e);return o.className=t,o},i.appendTo=function(e,t){return t.appendChild(e),e},i.css=function(e,t,o){return"object"==typeof t?a(e,t):"undefined"==typeof o?n(e,t):r(e,t,o)},i.matches=function(e,t){return"undefined"!=typeof e.matches?e.matches(t):"undefined"!=typeof e.matchesSelector?e.matchesSelector(t):"undefined"!=typeof e.webkitMatchesSelector?e.webkitMatchesSelector(t):"undefined"!=typeof e.mozMatchesSelector?e.mozMatchesSelector(t):"undefined"!=typeof e.msMatchesSelector?e.msMatchesSelector(t):void 0},i.remove=function(e){"undefined"!=typeof e.remove?e.remove():e.parentNode&&e.parentNode.removeChild(e)},i.queryChildren=function(e,t){return Array.prototype.filter.call(e.childNodes,function(e){return i.matches(e,t)})},t.exports=i},{}],4:[function(e,t,o){"use strict";var n=function(e){this.element=e,this.events={}};n.prototype.bind=function(e,t){"undefined"==typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t),this.element.addEventListener(e,t,!1)},n.prototype.unbind=function(e,t){var o="undefined"!=typeof t;this.events[e]=this.events[e].filter(function(n){return o&&n!==t?!0:(this.element.removeEventListener(e,n,!1),!1)},this)},n.prototype.unbindAll=function(){for(var e in this.events)this.unbind(e)};var r=function(){this.eventElements=[]};r.prototype.eventElement=function(e){var t=this.eventElements.filter(function(t){return t.element===e})[0];return"undefined"==typeof t&&(t=new n(e),this.eventElements.push(t)),t},r.prototype.bind=function(e,t,o){this.eventElement(e).bind(t,o)},r.prototype.unbind=function(e,t,o){this.eventElement(e).unbind(t,o)},r.prototype.unbindAll=function(){for(var e=0;e<this.eventElements.length;e++)this.eventElements[e].unbindAll()},r.prototype.once=function(e,t,o){var n=this.eventElement(e),r=function(e){n.unbind(t,r),o(e)};n.bind(t,r)},t.exports=r},{}],5:[function(e,t,o){"use strict";t.exports=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}()},{}],6:[function(e,t,o){"use strict";var n=e("./class"),r=e("./dom"),a=o.toInt=function(e){return parseInt(e,10)||0},i=o.clone=function(e){if(null===e)return null;if(e.constructor===Array)return e.map(i);if("object"==typeof e){var t={};for(var o in e)t[o]=i(e[o]);return t}return e};o.extend=function(e,t){var o=i(e);for(var n in t)o[n]=i(t[n]);return o},o.isEditable=function(e){return r.matches(e,"input,[contenteditable]")||r.matches(e,"select,[contenteditable]")||r.matches(e,"textarea,[contenteditable]")||r.matches(e,"button,[contenteditable]")},o.removePsClasses=function(e){for(var t=n.list(e),o=0;o<t.length;o++){var r=t[o];0===r.indexOf("ps-")&&n.remove(e,r)}},o.outerWidth=function(e){return a(r.css(e,"width"))+a(r.css(e,"paddingLeft"))+a(r.css(e,"paddingRight"))+a(r.css(e,"borderLeftWidth"))+a(r.css(e,"borderRightWidth"))},o.startScrolling=function(e,t){n.add(document.body,"ps-in-scrolling"),"undefined"!=typeof t?n.add(e,"ps-"+t):(n.add(e,"ps-x"),n.add(e,"ps-y"))},o.stopScrolling=function(e,t){n.remove(document.body,"ps-in-scrolling"),"undefined"!=typeof t?n.remove(e,"ps-"+t):(n.remove(e,"ps-x"),n.remove(e,"ps-y"))},o.env={isWebKit:"WebkitAppearance"in document.documentElement.style,supportsTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsIePointer:null!==window.navigator.msMaxTouchPoints}},{"./class":2,"./dom":3}],7:[function(e,t,o){"use strict";var n=e("./plugin/destroy"),r=e("./plugin/initialize"),a=e("./plugin/update");t.exports={initialize:r,update:a,destroy:n}},{"./plugin/destroy":9,"./plugin/initialize":17,"./plugin/update":21}],8:[function(e,t,o){"use strict";t.exports={handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollXMarginOffset:0,scrollYMarginOffset:0,stopPropagationOnClick:!0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,useBothWheelAxes:!1,wheelPropagation:!1,wheelSpeed:1,theme:"default"}},{}],9:[function(e,t,o){"use strict";var n=e("../lib/helper"),r=e("../lib/dom"),a=e("./instances");t.exports=function(e){var t=a.get(e);t&&(t.event.unbindAll(),r.remove(t.scrollbarX),r.remove(t.scrollbarY),r.remove(t.scrollbarXRail),r.remove(t.scrollbarYRail),n.removePsClasses(e),a.remove(e))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18}],10:[function(e,t,o){"use strict";function n(e,t){function o(e){return e.getBoundingClientRect()}var n=function(e){e.stopPropagation()};t.settings.stopPropagationOnClick&&t.event.bind(t.scrollbarY,"click",n),t.event.bind(t.scrollbarYRail,"click",function(n){var a=r.toInt(t.scrollbarYHeight/2),s=t.railYRatio*(n.pageY-window.pageYOffset-o(t.scrollbarYRail).top-a),c=t.railYRatio*(t.railYHeight-t.scrollbarYHeight),u=s/c;0>u?u=0:u>1&&(u=1),l(e,"top",(t.contentHeight-t.containerHeight)*u),i(e),n.stopPropagation()}),t.settings.stopPropagationOnClick&&t.event.bind(t.scrollbarX,"click",n),t.event.bind(t.scrollbarXRail,"click",function(n){var a=r.toInt(t.scrollbarXWidth/2),s=t.railXRatio*(n.pageX-window.pageXOffset-o(t.scrollbarXRail).left-a),c=t.railXRatio*(t.railXWidth-t.scrollbarXWidth),u=s/c;0>u?u=0:u>1&&(u=1),l(e,"left",(t.contentWidth-t.containerWidth)*u-t.negativeScrollAdjustment),i(e),n.stopPropagation()})}var r=e("../../lib/helper"),a=e("../instances"),i=e("../update-geometry"),l=e("../update-scroll");t.exports=function(e){var t=a.get(e);n(e,t)}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],11:[function(e,t,o){"use strict";function n(e,t){function o(o){var r=n+o*t.railXRatio,i=Math.max(0,t.scrollbarXRail.getBoundingClientRect().left)+t.railXRatio*(t.railXWidth-t.scrollbarXWidth);0>r?t.scrollbarXLeft=0:r>i?t.scrollbarXLeft=i:t.scrollbarXLeft=r;var l=a.toInt(t.scrollbarXLeft*(t.contentWidth-t.containerWidth)/(t.containerWidth-t.railXRatio*t.scrollbarXWidth))-t.negativeScrollAdjustment;c(e,"left",l)}var n=null,r=null,l=function(t){o(t.pageX-r),s(e),t.stopPropagation(),t.preventDefault()},u=function(){a.stopScrolling(e,"x"),t.event.unbind(t.ownerDocument,"mousemove",l)};t.event.bind(t.scrollbarX,"mousedown",function(o){r=o.pageX,n=a.toInt(i.css(t.scrollbarX,"left"))*t.railXRatio,a.startScrolling(e,"x"),t.event.bind(t.ownerDocument,"mousemove",l),t.event.once(t.ownerDocument,"mouseup",u),o.stopPropagation(),o.preventDefault()})}function r(e,t){function o(o){var r=n+o*t.railYRatio,i=Math.max(0,t.scrollbarYRail.getBoundingClientRect().top)+t.railYRatio*(t.railYHeight-t.scrollbarYHeight);0>r?t.scrollbarYTop=0:r>i?t.scrollbarYTop=i:t.scrollbarYTop=r;var l=a.toInt(t.scrollbarYTop*(t.contentHeight-t.containerHeight)/(t.containerHeight-t.railYRatio*t.scrollbarYHeight));c(e,"top",l)}var n=null,r=null,l=function(t){o(t.pageY-r),s(e),t.stopPropagation(),t.preventDefault()},u=function(){a.stopScrolling(e,"y"),t.event.unbind(t.ownerDocument,"mousemove",l)};t.event.bind(t.scrollbarY,"mousedown",function(o){r=o.pageY,n=a.toInt(i.css(t.scrollbarY,"top"))*t.railYRatio,a.startScrolling(e,"y"),t.event.bind(t.ownerDocument,"mousemove",l),t.event.once(t.ownerDocument,"mouseup",u),o.stopPropagation(),o.preventDefault()})}var a=e("../../lib/helper"),i=e("../../lib/dom"),l=e("../instances"),s=e("../update-geometry"),c=e("../update-scroll");t.exports=function(e){var t=l.get(e);n(e,t),r(e,t)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],12:[function(e,t,o){"use strict";function n(e,t){function o(o,n){var r=e.scrollTop;if(0===o){if(!t.scrollbarYActive)return!1;if(0===r&&n>0||r>=t.contentHeight-t.containerHeight&&0>n)return!t.settings.wheelPropagation}var a=e.scrollLeft;if(0===n){if(!t.scrollbarXActive)return!1;if(0===a&&0>o||a>=t.contentWidth-t.containerWidth&&o>0)return!t.settings.wheelPropagation}return!0}var n=!1;t.event.bind(e,"mouseenter",function(){n=!0}),t.event.bind(e,"mouseleave",function(){n=!1});var i=!1;t.event.bind(t.ownerDocument,"keydown",function(c){if(!c.isDefaultPrevented||!c.isDefaultPrevented()){var u=a.matches(t.scrollbarX,":focus")||a.matches(t.scrollbarY,":focus");if(n||u){var d=document.activeElement?document.activeElement:t.ownerDocument.activeElement;if(d){if("IFRAME"===d.tagName)d=d.contentDocument.activeElement;else for(;d.shadowRoot;)d=d.shadowRoot.activeElement;if(r.isEditable(d))return}var p=0,f=0;switch(c.which){case 37:p=-30;break;case 38:f=30;break;case 39:p=30;break;case 40:f=-30;break;case 33:f=90;break;case 32:f=c.shiftKey?90:-90;break;case 34:f=-90;break;case 35:f=c.ctrlKey?-t.contentHeight:-t.containerHeight;break;case 36:f=c.ctrlKey?e.scrollTop:t.containerHeight;break;default:return}s(e,"top",e.scrollTop-f),s(e,"left",e.scrollLeft+p),l(e),i=o(p,f),i&&c.preventDefault()}}})}var r=e("../../lib/helper"),a=e("../../lib/dom"),i=e("../instances"),l=e("../update-geometry"),s=e("../update-scroll");t.exports=function(e){var t=i.get(e);n(e,t)}},{"../../lib/dom":3,
"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],13:[function(e,t,o){"use strict";function n(e,t){function o(o,n){var r=e.scrollTop;if(0===o){if(!t.scrollbarYActive)return!1;if(0===r&&n>0||r>=t.contentHeight-t.containerHeight&&0>n)return!t.settings.wheelPropagation}var a=e.scrollLeft;if(0===n){if(!t.scrollbarXActive)return!1;if(0===a&&0>o||a>=t.contentWidth-t.containerWidth&&o>0)return!t.settings.wheelPropagation}return!0}function n(e){var t=e.deltaX,o=-1*e.deltaY;return("undefined"==typeof t||"undefined"==typeof o)&&(t=-1*e.wheelDeltaX/6,o=e.wheelDeltaY/6),e.deltaMode&&1===e.deltaMode&&(t*=10,o*=10),t!==t&&o!==o&&(t=0,o=e.wheelDelta),[t,o]}function r(t,o){var n=e.querySelector("textarea:hover, .ps-child:hover");if(n){if("TEXTAREA"!==n.tagName&&!window.getComputedStyle(n).overflow.match(/(scroll|auto)/))return!1;var r=n.scrollHeight-n.clientHeight;if(r>0&&!(0===n.scrollTop&&o>0||n.scrollTop===r&&0>o))return!0;var a=n.scrollLeft-n.clientWidth;if(a>0&&!(0===n.scrollLeft&&0>t||n.scrollLeft===a&&t>0))return!0}return!1}function l(l){var c=n(l),u=c[0],d=c[1];r(u,d)||(s=!1,t.settings.useBothWheelAxes?t.scrollbarYActive&&!t.scrollbarXActive?(d?i(e,"top",e.scrollTop-d*t.settings.wheelSpeed):i(e,"top",e.scrollTop+u*t.settings.wheelSpeed),s=!0):t.scrollbarXActive&&!t.scrollbarYActive&&(u?i(e,"left",e.scrollLeft+u*t.settings.wheelSpeed):i(e,"left",e.scrollLeft-d*t.settings.wheelSpeed),s=!0):(i(e,"top",e.scrollTop-d*t.settings.wheelSpeed),i(e,"left",e.scrollLeft+u*t.settings.wheelSpeed)),a(e),s=s||o(u,d),s&&(l.stopPropagation(),l.preventDefault()))}var s=!1;"undefined"!=typeof window.onwheel?t.event.bind(e,"wheel",l):"undefined"!=typeof window.onmousewheel&&t.event.bind(e,"mousewheel",l)}var r=e("../instances"),a=e("../update-geometry"),i=e("../update-scroll");t.exports=function(e){var t=r.get(e);n(e,t)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],14:[function(e,t,o){"use strict";function n(e,t){t.event.bind(e,"scroll",function(){a(e)})}var r=e("../instances"),a=e("../update-geometry");t.exports=function(e){var t=r.get(e);n(e,t)}},{"../instances":18,"../update-geometry":19}],15:[function(e,t,o){"use strict";function n(e,t){function o(){var e=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"";return 0===e.toString().length?null:e.getRangeAt(0).commonAncestorContainer}function n(){c||(c=setInterval(function(){return a.get(e)?(l(e,"top",e.scrollTop+u.top),l(e,"left",e.scrollLeft+u.left),void i(e)):void clearInterval(c)},50))}function s(){c&&(clearInterval(c),c=null),r.stopScrolling(e)}var c=null,u={top:0,left:0},d=!1;t.event.bind(t.ownerDocument,"selectionchange",function(){e.contains(o())?d=!0:(d=!1,s())}),t.event.bind(window,"mouseup",function(){d&&(d=!1,s())}),t.event.bind(window,"mousemove",function(t){if(d){var o={x:t.pageX,y:t.pageY},a={left:e.offsetLeft,right:e.offsetLeft+e.offsetWidth,top:e.offsetTop,bottom:e.offsetTop+e.offsetHeight};o.x<a.left+3?(u.left=-5,r.startScrolling(e,"x")):o.x>a.right-3?(u.left=5,r.startScrolling(e,"x")):u.left=0,o.y<a.top+3?(a.top+3-o.y<5?u.top=-5:u.top=-20,r.startScrolling(e,"y")):o.y>a.bottom-3?(o.y-a.bottom+3<5?u.top=5:u.top=20,r.startScrolling(e,"y")):u.top=0,0===u.top&&0===u.left?s():n()}})}var r=e("../../lib/helper"),a=e("../instances"),i=e("../update-geometry"),l=e("../update-scroll");t.exports=function(e){var t=a.get(e);n(e,t)}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],16:[function(e,t,o){"use strict";function n(e,t,o,n){function r(o,n){var r=e.scrollTop,a=e.scrollLeft,i=Math.abs(o),l=Math.abs(n);if(l>i){if(0>n&&r===t.contentHeight-t.containerHeight||n>0&&0===r)return!t.settings.swipePropagation}else if(i>l&&(0>o&&a===t.contentWidth-t.containerWidth||o>0&&0===a))return!t.settings.swipePropagation;return!0}function s(t,o){l(e,"top",e.scrollTop-o),l(e,"left",e.scrollLeft-t),i(e)}function c(){w=!0}function u(){w=!1}function d(e){return e.targetTouches?e.targetTouches[0]:e}function p(e){return e.targetTouches&&1===e.targetTouches.length?!0:e.pointerType&&"mouse"!==e.pointerType&&e.pointerType!==e.MSPOINTER_TYPE_MOUSE?!0:!1}function f(e){if(p(e)){k=!0;var t=d(e);g.pageX=t.pageX,g.pageY=t.pageY,b=(new Date).getTime(),null!==y&&clearInterval(y),e.stopPropagation()}}function m(e){if(!k&&t.settings.swipePropagation&&f(e),!w&&k&&p(e)){var o=d(e),n={pageX:o.pageX,pageY:o.pageY},a=n.pageX-g.pageX,i=n.pageY-g.pageY;s(a,i),g=n;var l=(new Date).getTime(),c=l-b;c>0&&(v.x=a/c,v.y=i/c,b=l),r(a,i)&&(e.stopPropagation(),e.preventDefault())}}function h(){!w&&k&&(k=!1,clearInterval(y),y=setInterval(function(){return a.get(e)?Math.abs(v.x)<.01&&Math.abs(v.y)<.01?void clearInterval(y):(s(30*v.x,30*v.y),v.x*=.8,void(v.y*=.8)):void clearInterval(y)},10))}var g={},b=0,v={},y=null,w=!1,k=!1;o&&(t.event.bind(window,"touchstart",c),t.event.bind(window,"touchend",u),t.event.bind(e,"touchstart",f),t.event.bind(e,"touchmove",m),t.event.bind(e,"touchend",h)),n&&(window.PointerEvent?(t.event.bind(window,"pointerdown",c),t.event.bind(window,"pointerup",u),t.event.bind(e,"pointerdown",f),t.event.bind(e,"pointermove",m),t.event.bind(e,"pointerup",h)):window.MSPointerEvent&&(t.event.bind(window,"MSPointerDown",c),t.event.bind(window,"MSPointerUp",u),t.event.bind(e,"MSPointerDown",f),t.event.bind(e,"MSPointerMove",m),t.event.bind(e,"MSPointerUp",h)))}var r=e("../../lib/helper"),a=e("../instances"),i=e("../update-geometry"),l=e("../update-scroll");t.exports=function(e){if(r.env.supportsTouch||r.env.supportsIePointer){var t=a.get(e);n(e,t,r.env.supportsTouch,r.env.supportsIePointer)}}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],17:[function(e,t,o){"use strict";var n=e("../lib/helper"),r=e("../lib/class"),a=e("./instances"),i=e("./update-geometry"),l={"click-rail":e("./handler/click-rail"),"drag-scrollbar":e("./handler/drag-scrollbar"),keyboard:e("./handler/keyboard"),wheel:e("./handler/mouse-wheel"),touch:e("./handler/touch"),selection:e("./handler/selection")},s=e("./handler/native-scroll");t.exports=function(e,t){t="object"==typeof t?t:{},r.add(e,"ps-container");var o=a.add(e);o.settings=n.extend(o.settings,t),r.add(e,"ps-theme-"+o.settings.theme),o.settings.handlers.forEach(function(t){l[t](e)}),s(e),i(e)}},{"../lib/class":2,"../lib/helper":6,"./handler/click-rail":10,"./handler/drag-scrollbar":11,"./handler/keyboard":12,"./handler/mouse-wheel":13,"./handler/native-scroll":14,"./handler/selection":15,"./handler/touch":16,"./instances":18,"./update-geometry":19}],18:[function(e,t,o){"use strict";function n(e){function t(){s.add(e,"ps-focus")}function o(){s.remove(e,"ps-focus")}var n=this;n.settings=l.clone(c),n.containerWidth=null,n.containerHeight=null,n.contentWidth=null,n.contentHeight=null,n.isRtl="rtl"===u.css(e,"direction"),n.isNegativeScroll=function(){var t=e.scrollLeft,o=null;return e.scrollLeft=-1,o=e.scrollLeft<0,e.scrollLeft=t,o}(),n.negativeScrollAdjustment=n.isNegativeScroll?e.scrollWidth-e.clientWidth:0,n.event=new d,n.ownerDocument=e.ownerDocument||document,n.scrollbarXRail=u.appendTo(u.e("div","ps-scrollbar-x-rail"),e),n.scrollbarX=u.appendTo(u.e("div","ps-scrollbar-x"),n.scrollbarXRail),n.scrollbarX.setAttribute("tabindex",0),n.event.bind(n.scrollbarX,"focus",t),n.event.bind(n.scrollbarX,"blur",o),n.scrollbarXActive=null,n.scrollbarXWidth=null,n.scrollbarXLeft=null,n.scrollbarXBottom=l.toInt(u.css(n.scrollbarXRail,"bottom")),n.isScrollbarXUsingBottom=n.scrollbarXBottom===n.scrollbarXBottom,n.scrollbarXTop=n.isScrollbarXUsingBottom?null:l.toInt(u.css(n.scrollbarXRail,"top")),n.railBorderXWidth=l.toInt(u.css(n.scrollbarXRail,"borderLeftWidth"))+l.toInt(u.css(n.scrollbarXRail,"borderRightWidth")),u.css(n.scrollbarXRail,"display","block"),n.railXMarginWidth=l.toInt(u.css(n.scrollbarXRail,"marginLeft"))+l.toInt(u.css(n.scrollbarXRail,"marginRight")),u.css(n.scrollbarXRail,"display",""),n.railXWidth=null,n.railXRatio=null,n.scrollbarYRail=u.appendTo(u.e("div","ps-scrollbar-y-rail"),e),n.scrollbarY=u.appendTo(u.e("div","ps-scrollbar-y"),n.scrollbarYRail),n.scrollbarY.setAttribute("tabindex",0),n.event.bind(n.scrollbarY,"focus",t),n.event.bind(n.scrollbarY,"blur",o),n.scrollbarYActive=null,n.scrollbarYHeight=null,n.scrollbarYTop=null,n.scrollbarYRight=l.toInt(u.css(n.scrollbarYRail,"right")),n.isScrollbarYUsingRight=n.scrollbarYRight===n.scrollbarYRight,n.scrollbarYLeft=n.isScrollbarYUsingRight?null:l.toInt(u.css(n.scrollbarYRail,"left")),n.scrollbarYOuterWidth=n.isRtl?l.outerWidth(n.scrollbarY):null,n.railBorderYWidth=l.toInt(u.css(n.scrollbarYRail,"borderTopWidth"))+l.toInt(u.css(n.scrollbarYRail,"borderBottomWidth")),u.css(n.scrollbarYRail,"display","block"),n.railYMarginHeight=l.toInt(u.css(n.scrollbarYRail,"marginTop"))+l.toInt(u.css(n.scrollbarYRail,"marginBottom")),u.css(n.scrollbarYRail,"display",""),n.railYHeight=null,n.railYRatio=null}function r(e){return e.getAttribute("data-ps-id")}function a(e,t){e.setAttribute("data-ps-id",t)}function i(e){e.removeAttribute("data-ps-id")}var l=e("../lib/helper"),s=e("../lib/class"),c=e("./default-setting"),u=e("../lib/dom"),d=e("../lib/event-manager"),p=e("../lib/guid"),f={};o.add=function(e){var t=p();return a(e,t),f[t]=new n(e),f[t]},o.remove=function(e){delete f[r(e)],i(e)},o.get=function(e){return f[r(e)]}},{"../lib/class":2,"../lib/dom":3,"../lib/event-manager":4,"../lib/guid":5,"../lib/helper":6,"./default-setting":8}],19:[function(e,t,o){"use strict";function n(e,t){return e.settings.minScrollbarLength&&(t=Math.max(t,e.settings.minScrollbarLength)),e.settings.maxScrollbarLength&&(t=Math.min(t,e.settings.maxScrollbarLength)),t}function r(e,t){var o={width:t.railXWidth};t.isRtl?o.left=t.negativeScrollAdjustment+e.scrollLeft+t.containerWidth-t.contentWidth:o.left=e.scrollLeft,t.isScrollbarXUsingBottom?o.bottom=t.scrollbarXBottom-e.scrollTop:o.top=t.scrollbarXTop+e.scrollTop,l.css(t.scrollbarXRail,o);var n={top:e.scrollTop,height:t.railYHeight};t.isScrollbarYUsingRight?t.isRtl?n.right=t.contentWidth-(t.negativeScrollAdjustment+e.scrollLeft)-t.scrollbarYRight-t.scrollbarYOuterWidth:n.right=t.scrollbarYRight-e.scrollLeft:t.isRtl?n.left=t.negativeScrollAdjustment+e.scrollLeft+2*t.containerWidth-t.contentWidth-t.scrollbarYLeft-t.scrollbarYOuterWidth:n.left=t.scrollbarYLeft+e.scrollLeft,l.css(t.scrollbarYRail,n),l.css(t.scrollbarX,{left:t.scrollbarXLeft,width:t.scrollbarXWidth-t.railBorderXWidth}),l.css(t.scrollbarY,{top:t.scrollbarYTop,height:t.scrollbarYHeight-t.railBorderYWidth})}var a=e("../lib/helper"),i=e("../lib/class"),l=e("../lib/dom"),s=e("./instances"),c=e("./update-scroll");t.exports=function(e){var t=s.get(e);t.containerWidth=e.clientWidth,t.containerHeight=e.clientHeight,t.contentWidth=e.scrollWidth,t.contentHeight=e.scrollHeight;var o;e.contains(t.scrollbarXRail)||(o=l.queryChildren(e,".ps-scrollbar-x-rail"),o.length>0&&o.forEach(function(e){l.remove(e)}),l.appendTo(t.scrollbarXRail,e)),e.contains(t.scrollbarYRail)||(o=l.queryChildren(e,".ps-scrollbar-y-rail"),o.length>0&&o.forEach(function(e){l.remove(e)}),l.appendTo(t.scrollbarYRail,e)),!t.settings.suppressScrollX&&t.containerWidth+t.settings.scrollXMarginOffset<t.contentWidth?(t.scrollbarXActive=!0,t.railXWidth=t.containerWidth-t.railXMarginWidth,t.railXRatio=t.containerWidth/t.railXWidth,t.scrollbarXWidth=n(t,a.toInt(t.railXWidth*t.containerWidth/t.contentWidth)),t.scrollbarXLeft=a.toInt((t.negativeScrollAdjustment+e.scrollLeft)*(t.railXWidth-t.scrollbarXWidth)/(t.contentWidth-t.containerWidth))):t.scrollbarXActive=!1,!t.settings.suppressScrollY&&t.containerHeight+t.settings.scrollYMarginOffset<t.contentHeight?(t.scrollbarYActive=!0,t.railYHeight=t.containerHeight-t.railYMarginHeight,t.railYRatio=t.containerHeight/t.railYHeight,t.scrollbarYHeight=n(t,a.toInt(t.railYHeight*t.containerHeight/t.contentHeight)),t.scrollbarYTop=a.toInt(e.scrollTop*(t.railYHeight-t.scrollbarYHeight)/(t.contentHeight-t.containerHeight))):t.scrollbarYActive=!1,t.scrollbarXLeft>=t.railXWidth-t.scrollbarXWidth&&(t.scrollbarXLeft=t.railXWidth-t.scrollbarXWidth),t.scrollbarYTop>=t.railYHeight-t.scrollbarYHeight&&(t.scrollbarYTop=t.railYHeight-t.scrollbarYHeight),r(e,t),t.scrollbarXActive?i.add(e,"ps-active-x"):(i.remove(e,"ps-active-x"),t.scrollbarXWidth=0,t.scrollbarXLeft=0,c(e,"left",0)),t.scrollbarYActive?i.add(e,"ps-active-y"):(i.remove(e,"ps-active-y"),t.scrollbarYHeight=0,t.scrollbarYTop=0,c(e,"top",0))}},{"../lib/class":2,"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-scroll":20}],20:[function(e,t,o){"use strict";var n,r,a=e("./instances"),i=document.createEvent("Event"),l=document.createEvent("Event"),s=document.createEvent("Event"),c=document.createEvent("Event"),u=document.createEvent("Event"),d=document.createEvent("Event"),p=document.createEvent("Event"),f=document.createEvent("Event"),m=document.createEvent("Event"),h=document.createEvent("Event");i.initEvent("ps-scroll-up",!0,!0),l.initEvent("ps-scroll-down",!0,!0),s.initEvent("ps-scroll-left",!0,!0),c.initEvent("ps-scroll-right",!0,!0),u.initEvent("ps-scroll-y",!0,!0),d.initEvent("ps-scroll-x",!0,!0),p.initEvent("ps-x-reach-start",!0,!0),f.initEvent("ps-x-reach-end",!0,!0),m.initEvent("ps-y-reach-start",!0,!0),h.initEvent("ps-y-reach-end",!0,!0),t.exports=function(e,t,o){if("undefined"==typeof e)throw"You must provide an element to the update-scroll function";if("undefined"==typeof t)throw"You must provide an axis to the update-scroll function";if("undefined"==typeof o)throw"You must provide a value to the update-scroll function";"top"===t&&0>=o&&(e.scrollTop=o=0,e.dispatchEvent(m)),"left"===t&&0>=o&&(e.scrollLeft=o=0,e.dispatchEvent(p));var g=a.get(e);"top"===t&&o>=g.contentHeight-g.containerHeight&&(o=g.contentHeight-g.containerHeight,o-e.scrollTop<=1?o=e.scrollTop:e.scrollTop=o,e.dispatchEvent(h)),"left"===t&&o>=g.contentWidth-g.containerWidth&&(o=g.contentWidth-g.containerWidth,o-e.scrollLeft<=1?o=e.scrollLeft:e.scrollLeft=o,e.dispatchEvent(f)),n||(n=e.scrollTop),r||(r=e.scrollLeft),"top"===t&&n>o&&e.dispatchEvent(i),"top"===t&&o>n&&e.dispatchEvent(l),"left"===t&&r>o&&e.dispatchEvent(s),"left"===t&&o>r&&e.dispatchEvent(c),"top"===t&&(e.scrollTop=n=o,e.dispatchEvent(u)),"left"===t&&(e.scrollLeft=r=o,e.dispatchEvent(d))}},{"./instances":18}],21:[function(e,t,o){"use strict";var n=e("../lib/helper"),r=e("../lib/dom"),a=e("./instances"),i=e("./update-geometry"),l=e("./update-scroll");t.exports=function(e){var t=a.get(e);t&&(t.negativeScrollAdjustment=t.isNegativeScroll?e.scrollWidth-e.clientWidth:0,r.css(t.scrollbarXRail,"display","block"),r.css(t.scrollbarYRail,"display","block"),t.railXMarginWidth=n.toInt(r.css(t.scrollbarXRail,"marginLeft"))+n.toInt(r.css(t.scrollbarXRail,"marginRight")),t.railYMarginHeight=n.toInt(r.css(t.scrollbarYRail,"marginTop"))+n.toInt(r.css(t.scrollbarYRail,"marginBottom")),r.css(t.scrollbarXRail,"display","none"),r.css(t.scrollbarYRail,"display","none"),i(e),l(e,"top",e.scrollTop),l(e,"left",e.scrollLeft),r.css(t.scrollbarXRail,"display",""),r.css(t.scrollbarYRail,"display",""))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-geometry":19,"./update-scroll":20}]},{},[1]);var sessions={login:function(e,t,o){var n=$("#bookmark_icon"),r="fa fa-bookmark";myBookmarks=o,localStorage.setItem("is_logged_in","true"),MyAjax.popupForm(e[0],e[1],e[2]).newNavbar(t),r=myBookmarks.indexOf(currentStory)>-1?r:r+"-o",n.removeClass().addClass(r)},logout:function(e,t){localStorage.setItem("is_logged_in","false"),MyAjax.popupForm(e[0],e[1],e[2]).newNavbar(t),delete window.myBookmarks}},ShowStory={onLoad:function(e){currentStory=e,$("#story-modal").perfectScrollbar({scrollYMarginOffset:8}),StoryModal.optionsPanel.initialize(),setTimeout(function(){Navbar.hide(),$("#modal-container, #story-modal").addClass("show-modal")},500)}};$(function(){function e(){$("#modal-container").css("background-image","url("+o+")"),Navbar.hide(),$("body").removeClass("cursor-wait"),setTimeout(function(){t||(t=$("#modal-container, #story-modal")),t.addClass("show-modal")},100)}var t,o,n=window,r=document,a=$("body"),i=r.getElementById("story-modal"),l=(r.getElementById("story-container"),$("#story-title")),s=$("#story-author"),c=$("#story-content"),u=$("#bookmark_icon"),d=$("#svg_holder"),p="perfectScrollbar",f=$("#image_loader");n.StoryModal={show:function(e){o="https://source.unsplash.com/1600x900",currentStory=e.id,r.title=e.title+" | Stories on a Map",l.text(e.title),s.text(e.author),c.html(e.content),"undefined"!=typeof myBookmarks&&myBookmarks.indexOf(e.id)>-1?u.removeClass().addClass("fa fa-bookmark"):u.hasClass("fa-bookmark")&&u.removeClass().addClass("fa fa-bookmark-o"),e.picture.picture.url?d.css("background-image","url("+e.picture.picture.url+")"):d.css("background-image","url("+o+")"),e.background.background.url&&(o=e.background.background.url),f.attr("src",o),$(i)[p]({scrollYMarginOffset:8}),i.scrollTop=0},hide:function(){r.title="Stories on a Map",t.removeClass("show-modal"),a.removeClass("fade-back-gradient"),$("#image_panel").html('<i class="fa fa-picture-o"></i>'),Navbar.show(),$(i)[p]("destroy")},handleImages:function(){$(i).on("click","img",function(){BigPicture.create({el:this})})},optionsPanel:{initialize:function(){$(".panel-section").hover(function(){StoryModal.optionsPanel.hover(this.id)},function(){StoryModal.optionsPanel.hidePopup()}),$(".panel-section").click(function(){StoryModal.optionsPanel.click(this.id)})},hover:function(e){var t;switch(e){case"close_panel":t="Return to the map";break;case"bookmark_panel":t="Bookmark this story";break;case"image_panel":t="Toggle story / background image";break;case"twitter_panel":t="Tweet this story";break;case"night_mode_panel":t="Toggle night mode";break;case"font_panel":t="Font options";break;case"fontface_panel":t="Choose font";break;case"font_larger_panel":t="Increase font size";break;case"font_smaller_panel":t="Decrease font size";break;case"font_close_panel":t="Close font options";break;case"save_panel":t="Save your progress";break;case"load_panel":t="Load last save";break;case"img_upload_panel":t="Add header and background images";break;case"audio_panel":t="Add story audio (optional)";break;case"submit_panel":t="Submit story to the map";break;default:t="Error: we are bad at coding"}$("#options-popup").text(t).addClass("show-options")},click:function(e){switch(StoryModal.optionsPanel.hidePopup(),e){case"close_panel":void 0===myMap.map?window.location.assign("/"):(history.pushState({slug:""},null,"/"),StoryModal.hide());break;case"bookmark_panel":u.hasClass("fa-bookmark-o")?Bookmarks.sendRequest("POST",currentStory):u.hasClass("fa-bookmark")&&Bookmarks.sendRequest("DELETE",currentStory);break;case"image_panel":$(i).toggleClass("show-modal"),a.toggleClass("fade-back-gradient");break;case"twitter_panel":var t=575,o=400,n=($(window).width()-t)/2,r=($(window).height()-o)/2,d="https://twitter.com/share?url="+encodeURIComponent(window.location.href.replace("?status=new",""))+"&text="+encodeURIComponent('"'+l.text()+'" by '+s.text());return opts="status=1,width="+t+",height="+o+",top="+r+",left="+n,window.open(d,"twitter",opts),!1;case"night_mode_panel":a.hasClass("night-mode")?a.removeClass("night-mode"):a.addClass("night-mode");break;case"font_panel":StoryModal.fontPopup.open();break;case"font_larger_panel":StoryModal.font.changeSize("larger");break;case"font_smaller_panel":StoryModal.font.changeSize("smaller");break;case"font_close_panel":StoryModal.fontPopup.close();break;case"save_panel":var p=confirm("Are you sure you want to save? This will overwrite all previous saves.");p===!0&&NewStory.saveStory();break;case"load_panel":var f=confirm("Are you sure you want to load your last save?");f===!0&&NewStory.loadStory();break;case"img_upload_panel":a.hasClass("show-image-upload-panel")?NewStory.imagePanel.hide():NewStory.imagePanel.show();break;case"audio_panel":NewStory.audioFile||(NewStory.audioFile="http://example.mp3"),MyAjax.popupForm("Audio","fa-volume-up",'<div class="pu-info">Enter link to mp3 or ogg file below. Many public domain recordings are available at <a target="_blank" href="https://librivox.org">librivox.org</a>.</p><form><input type="text" id="audio_input" style="text-align:center" placeholder="http://example.mp3"></form><input id="add_audio" type="submit" value="Add file" class="btn-purp" style="width:49%;margin: .5% .25% .5% .5%;"></input><input id="remove_audio" type="submit" value="Remove" class="btn-purp" style="width:49%;margin:.5% .5% .5% .25%;"></input>'),$("#add_audio").on("click",function(){c.find(".fa-volume-up, audio").remove(),c.prepend('<p><i class="fa fa-volume-up" file="'+$("#audio_input").val()+'" contenteditable="false"></p>'),HomePopup.close()}),$("#remove_audio").on("click",function(){c.find(".fa-volume-up, audio").remove(),HomePopup.close()});break;case"submit_panel":NewStory.validateForm();break;default:return"Panel not found"}},hidePopup:function(){$("#options-popup").removeClass("show-options")}},fontPopup:{open:function(){var e="";return function(){var t=["Josefin Sans","Sans-Serif","Serif","Lato","Open Sans","Roboto","Roboto Slab","Helvetica"];$.each(t,function(t,o){e+='<button style="font-family:'+o+'">'+o+"</button>"})}(),function(){0===$("#font-styles").length&&$(r.head).append("<link id='font-styles' href='https://fonts.googleapis.com/css?family=Open+Sans|Lato|Roboto|Roboto+Slab|Lora' rel='stylesheet' type='text/css'>"),MyAjax.popupForm("Font Options","fa-cog",'<div id="font_options">'+e+'<button id="decrease_font"><i class="fa fa-minus"></i> Decrease Size</button><button id="increase_font"><i class="fa fa-plus"></i> Increase Size</button></div>'),$("#font_options").on("click","button",StoryModal.fontPopup.bindClick)}}(),bindClick:function(){var e=this.id;if(e){var t=Number(c.css("font-size").slice(0,2));"increase_font"===e&&35>=t?t+=1:t>=11&&(t-=1),c.css("font-size",t+"px")}else{var o=$(this).css("font-family");c.css("font-family",o+", helvetica, sans-serif")}$(i)[p]("update")}}},f.on("load",e)});var UniversalScripts={initiate:function(){var e=$("#story-modal");MyAjax.checkLogin(),$("#home_popup").on("focus","input",function(){$(this).removeClass("input-error")});var t=function(){var t=e.find("#svg_holder"),o=t.height();return function(){var e=$(this).scrollTop();o>e&&t.css("transform","translate3d(0, "+.4*e+"px, 0)")}}();e.on("scroll",t),StoryModal.handleImages(),e.on("click",".fa-volume-up",function(e){var t=$(e.target);if(t.hasClass("rotate720"))return t.removeClass("rotate720"),void $("#story-content").find("audio").remove();var o=$(e.target).attr("file").split(/.\w+$/)[0],n=document.createElement("AUDIO");n.autoplay=!0,n.controls=!0,t.addClass("rotate720"),[".ogg",".mp3"].forEach(function(e){var t=document.createElement("SOURCE");t.src=o+e,n.appendChild(t)}),$("#story-content").prepend(n)}),$("#pu_head h2").dragmove(),window.addEventListener("resize",function(){clearTimeout(window.resizeTimeout),window.resizeTimeout=setTimeout(function(){$("#story-modal, #popup_inner").perfectScrollbar("update"),userPage.updateTextAnim()},200)},!1)}};!function(e){e.fn.dragmove=function(){return this.each(function(){var t,o,n,r=e(document),a=e(this),i=a.parents("#home_popup");a.on("mousedown touchstart",function(e){return t=!0,o=e.originalEvent.pageX-i.offset().left,n=e.originalEvent.pageY-i.offset().top,null===window.mozInnerScreenX?!1:void 0}),r.on("mousemove touchmove",function(e){t&&i.offset({left:e.originalEvent.pageX-o,top:e.originalEvent.pageY-n})}).on("mouseup touchend",function(){t=!1})})}}(jQuery),userPage={initiate:function(){var e=$(".story-container");this.storyContainers=[new storyContainer({el:e[0],stories:userPage.createdStories,type:"createdStories"}),new storyContainer({el:e[1],stories:userPage.bookmarks,type:"bookmarks"})]},updateDeletedStories:function(){var e=userPage.deletedStories;userPage.storyContainers.forEach(function(t){for(var o=t.storiesCopy,n=o.length,r=0;n>r;r++)if(e.indexOf(o[r].id)>-1){t.storiesCopy.remove(r);break}})},updateDeletedBookmarks:function(){for(var e=userPage.deletedBookmarks,t=userPage.storyContainers[1],o=t.storiesCopy,n=o.length,r=0;n>r;r++)if(e.indexOf(o[r].id)>-1){t.storiesCopy.remove(r);break}},updateTextAnim:function(){var e=document.querySelectorAll(".story-info p"),t='<style id="userstyle">';[].forEach.call(e,function(e,o){function n(e){var t="transform:translate3d(-50%, "+e+r+"px, 0);";return"-webkit-"+t+t}var r=e.clientHeight/2;e.parentElement.parentElement;t+=".story:nth-child("+(o+1)+"):hover h4{"+n("-")+"}.story:nth-child("+(o+1)+"):hover .story-buttons{"+n("")+"}"}),t+="</style>";var o=$("#userstyle");o.length>0?o[0].outerHTML=t:document.head.insertAdjacentHTML("beforeend",t)}},storyContainer.prototype.showMore=function(){var e=this.stories;if(0===e.length)return!1;for(var t="",o=e.length>6?6:e.length,n=0;o>n;n++){var r=e.pop();t+='<div class="story" style="background-image:url('+r.img+')"><H4 class="fa fa-book">'+r.title+'</H4><div class="story-info"><p>'+r.info+'</p></div><div class="story-buttons">'+(r.url?'<a id="'+r.id+'" href="/stories/'+r.url+'" data-sid="'+r.id+'" class="button but-website fa fa-newspaper-o">Read</a> ':"")+(userPage.ownPage&&"createdStories"===this.type?'<a data-confirm="Are you sure?" data-remote="true" data-method="delete" href="/stories/'+r.url+'" class="button but-delete fa fa-trash-o">Delete</a>':"")+(userPage.ownPage&&"bookmarks"===this.type?'<a data-remote="true" data-method="delete" href="/bookmarks/'+r.id+'" class="button but-delete fa fa-trash-o">Remove</a>':"")+"</div></div>"}this.showMoreEl[0].insertAdjacentHTML("beforebegin",t),this.updateStoryCount(),userPage.updateTextAnim()},storyContainer.prototype.updateStoryCount=function(){var e=this.stories.length>6?6:this.stories.length,t=e>0?"Show next "+e:"That's all for now";e>0?this.showMoreEl.text(t).show():this.showMoreEl.hide()},storyContainer.prototype.changeSort=function(e){return $(e.target).hasClass("sortStyle")?!1:($(this.el).find(".story").remove(),this.stories=this.storiesCopy.slice(0),e.target===this.sortButtons[1]&&this.stories.reverse(),this.showMore(),void this.sortButtons.each(function(){$(this).toggleClass("sortStyle")}))},Array.prototype.remove=function(e,t){var o=this.slice((t||e)+1||this.length);return this.length=0>e?this.length+e:e,this.push.apply(this,o)};